<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 이 공간에 있는 쿼리문들을 호출할 때 이름의 시작 -->
<mapper namespace="product">

	<!-- 상품등록 -->
	<insert id="insertProduct" parameterType="ProductVO">
		
		<selectKey keyProperty="productNo" resultType="int"
			order="BEFORE">
			SELECT seq_product_no.nextval AS productNo FROM dual
		</selectKey>
		
		<![CDATA[
			
			insert into product(
	                    PRODUCT_NO,
	                    PRODUCT_NAME,
	                    PRODUCT_EA,
	                    PRICE,
	                    PRODUCT_CONTENT,
	                    REG_DATE,
	                    CATEGORY,
	                    SUBCATEGORY
	                    )
	            values(
	                    #{productNo},
	                    #{productName},
	                    #{productEa},
	                    #{price},
	                    #{productContent},
	                    sysdate,
	                    #{category},
	                    #{subCategory}	            
	                    )
	

		]]>

	</insert>
	
	<!-- 상품삭제 -->
	<delete id="deleteProduct" parameterType="int">
		
		<![CDATA[
		
			delete from product where product_no = #{productNo}
		
		]]>
	
	</delete>
	
	<!-- 상품리스트 가져오기 -->
	<select id="getAllProductList" resultType="ProductVO">
	
		<![CDATA[
		
			SELECT
			      a.product_no as productNo,
			      product_name as productName,
			      product_ea as productEa,
			      price,
			      product_content as productContent,
			      reg_date as regDate,
			      category,
			      subcategory as subCategory,
			      b.save_name as saveName,
			      b.image_no as imageNo
			  FROM
			      product a
			      INNER JOIN product_image b 
			      ON a.product_no = b.product_no
			 ORDER BY
			      a.product_no DESC
		
		]]>	
	
	</select>
	
	<!-- 카테고리 상품 리스트 가져오기 -->
	<select id="getCategoryProductList" parameterType="ProductVO" resultType="ProductVO">
	
		<![CDATA[
		
			SELECT
			      a.product_no as productNo,
			      product_name as productName,
			      product_ea as productEa,
			      price,
			      product_content as productContent,
			      reg_date as regDate,
			      category,
			      subcategory as subCategory,
			      b.save_name as saveName,
			      b.image_no as imageNo
			  FROM
			      product a,
			      product_image b 
            where a.product_no = b.product_no
         ]]>     
          
	       		<if test="category != 'all'">
	        		AND a.category = '${category}'
			    </if>
			    <if test="subCategory != 'all'">
			        AND a.subcategory = '${subCategory}'
			    </if>
                
         <![CDATA[        
			 ORDER BY
			      a.product_no DESC
			
		]]>
	
	</select>
	
	<!-- 상품 정보 가져오기 -->
	<select id="getProduct" parameterType="ProductVO" resultType="ProductVO">
	
		<![CDATA[
		
			SELECT
			      a.product_no as productNo,
			      product_name as productName,
			      product_ea as productEa,
			      price,
			      product_content as productContent,
			      reg_date as regDate,
			      category,
			      subcategory as subCategory,
			      b.save_name as saveName,
			      b.image_no as imageNo
			  FROM
			      product a
			      INNER JOIN product_image b 
			      ON a.product_no = b.product_no
			  where
			      a.product_no = #{productNo}

		]]>	
	
	</select>
	
	<!-- 상품 정보 수정 -->
	<update id="modifyProduct" parameterType="ProductVO">
		
		<![CDATA[
		
			update product 
					   set                  
		                  product_name = #{productName},
		                  product_ea = #{productEa},
		                  price = #{price},
		                  product_content = #{productContent},
		                  category = #{category},
		                  subcategory = #{subCategory}
		        	where product_no = #{productNo}
	
		]]>
	
	
	</update>
	

</mapper>






